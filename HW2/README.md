# Financial Engineering  學習歷程  R08323002 
#### 作業二: 計算市場債券報價中的 YTM、Spot Rate、Forward Rate 以及建立 Forward Rate 對照表

## 先說程式執行方法

這支程式是用Python 3寫成的，在支援Python的IDE或終端機直接執行HW2目錄下的hw2_r08323002.py檔案，就可以依程式提示輸入每年計息次數和年數，以及債券票面利率和價格，程式會直接印出計算結果。  
  
因為輸出的年利率都是年利率、半年利率、季利率等年化後的利率(根據輸入的每年期數)，如果有需要轉換成其他期數的利率，可以透過HW2目錄下的convert.py檔案來轉換。

## 甚麼是 YTM(殖利率)、Spot Rate(即期利率)、Forward Rate(遠期利率)
see [參考資料1](https://wiki.mbalib.com/zh-tw/%E5%88%B0%E6%9C%9F%E6%94%B6%E7%9B%8A%E7%8E%87)  
>  所謂到期收益，是指將債券持有到償還期所獲得的收益，包括到期的全部利息。到期收益率又稱最終收益率和殖利率，是投資購買國債的內部收益率，即可以使投資購買國債獲得的未來現金流量的現值等於債券當前市價的貼現率。  

see [參考資料2](https://wiki.mbalib.com/zh-tw/%E5%8D%B3%E6%9C%9F%E5%88%A9%E7%8E%87)  
>  即期利率是指債券票面所標明的利率或購買債券時所獲得的折價收益與債券面值的比率。它是某一給定時點上無息證券的到期收益率。  

see [參考資料3](https://wiki.mbalib.com/zh-tw/%E8%BF%9C%E6%9C%9F%E5%88%A9%E7%8E%87)  
>  遠期利率則是指隱含在給定的即期利率之中，從未來的某一時點到另一時點的利率。

## 程式流程圖 

<img src="/HW2/hw2_flow.png" width = "600" height = "600" border="10" />

## 具體計算YTM、Spot Rate、Forward Rate 流程
#### YTM 殖利率
考慮總共付息n次，每年付息m次，票面金額F，票面利率c的債券，債券價格是p元。  
可得出每次付息C = Fc/m, 在利率為r下，第k期利息的現值為 C / ( 1 + r/m )^k  
理論價 PV = F / ( 1 + r/m )^n +  sum over k=1 to n  ( C / ( 1 + r/m )^k )  
滿足PV為債券價格的利率r即為殖利率YTM，此時 p = F / ( 1 + YTM/m )^n +  sum over k=1 to n  ( C / ( 1 + YTM/m )^k )  
在程式碼中用二分法得出YTM ( see [二分法](https://en.wikipedia.org/wiki/Bisection_method) )  
#### Spot Rate 即期利率
考慮到期時間i期，每年共有m期，票面金額F，票面利率0的零息債券，債券價格是p元。  
理論價 PV = F / ( 1 + r/m )^n  
滿足PV為債券價格的利率r即為即期利率Spot Rate S(i)，此時 p = F / ( 1 + S(i)/m )^n  
可得 S(i) = m * ( (F/p)^(1/n) - 1 )  
#### Forward Rate 遠期利率
每年共有m期，考慮兩種投資1元的方法，直接買k期的零息債券，或是先買i期零息債券，再用得到的錢來買(k-i)期零息債券。  
在第k期，前者可獲得(1+S(k)/m)^k元，後者可獲得( ( 1 + S(i)/m )^i )( ( 1 + S(i,k)/m )^(k-i)元，  
其中S(i,k)為距離現在i期，(k-i)期的Spot rate，即零息債券的YTM。  
滿足兩者相等的的S(i,k)即為第i期到第k期的遠期利率f(i,k)，此時 ( 1 + S(k)/m )^k = ( 1 + S(i)/m )^i ( 1 + f(i,k)/m )^(k-i)  
可得 f(i,k) = m * ( ( ( 1 + S(k)/m )^k / ( ( 1 + S(i)/m)^i ) )^( 1/(k-i) ) - 1 )

## 流程細節
計算殖利率的方法就如同上一節，要注意的地方是，投影片上的網站 (  see [參考資料4](https://www.calkoo.com/en/ytm-calculator) ) 如果使用半年計息或季計息，計算的時候是直接輸出半年利率或季利率，而非年化後的年利率(需乘以2或4)。  
  
依序由到期日1期開始計算即期利率至最後一期，計算即期利率需要將債券非到期日的現金流現值從價格扣除，注意到第k期現金流C的現值是 C / ( 1 + S(k)/m )^k 而非 C / ( 1 + YTM/m )^k ，投影片上的網站 ( see [參考資料5](http://greenhornfinancefootnote.blogspot.com/2010/06/how-to-compute-theoretical-spot-rates.html) ) 直接使用1.5年債券殖利率求得現金流現值是有問題的，會使到期時間1.5年的即期利率少0.01%。  
  
求得到期日k期的即期利率後就可以依上一節公式得出第i期到第k期的遠期利率f(i,k)， i 從 0 到 (k-1) 。要注意的地方是投影片上的網站 ( see [參考資料6](https://www.trignosource.com/finance/spot%20rate.html) [參考資料7](https://www.trignosource.com/finance/Forward%20rate.html) ) 是直接輸入單位債券特定時間的零息債券價格，而非1000元債券的價格。  
另外，hw2_r08323002.py預設從第一期開始輸入到最後一期，如果要像上述網站得出特定時間的即期利率或遠期利率，除了有關的期數需要變動，只需要將其他不相關期數的票面利率輸入0，債券價格輸入1000，即可得出和投影片網站相同的結果 (註:不相關欄位的數值無意義) 。
  

## 執行範例
### 執行版本
```
wwctw@gentoo ~/fe/ps2 $ python
```
```
Python 3.6.5 (default, Jul 16 2019, 13:36:36) 
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> exit()
```
### 執行結果  
註1: 如果輸出文字超過欄位，可以將輸出訊息複製到文字編輯軟體上，以利觀察輸出結果  
註2: 因為輸出的年利率都是年利率、半年利率、季利率等年化後的利率(根據輸入的每年期數)，如果有需要轉換成其他期數的利率，可以透過HW2目錄下的convert.py檔案來轉換。
```
wwctw@gentoo ~/fe/ps2 $ python hw2_r08323002.py 
```
```
   請輸入每年計息次數   年計息請輸入 1   半年計息請輸入 2   季計息請輸入 4 :  2
   請輸入總年數 :  1.5

   總共有  3  期

   面額1000元到期時間 0.50 年債券的債券
     請輸入票面利率(%) :  0
     請輸入債券價格 :  995

   面額1000元到期時間 1.00 年債券的債券
     請輸入票面利率(%) :  0
     請輸入債券價格 :  980.3

   面額1000元到期時間 1.50 年債券的債券
     請輸入票面利率(%) :  5
     請輸入債券價格 :  1029.1


   計算結果

   到期時間                     0.50 y       1.00 y       1.50 y 
   債券價格                   995.00       980.30      1029.10   
   票面利率                     0.00 %       0.00 %       5.00 % 
   債券殖利率                   1.01 %       2.00 %       3.00 % 
   即期利率                     1.01 %       2.00 %       3.04 % 


   遠期利率表      0.00 y       0.50 y       1.00 y       1.50 y 
     0.00 y                     1.01 %       2.00 %       3.04 % 
     0.50 y                                  3.00 %       4.06 % 
     1.00 y                                               5.12 % 
     1.50 y                                                      

```

## 心得
> 這次花蠻多時間把之前內容全部貫通，也把各種利率之間的關聯搞懂，感覺很踏實~
